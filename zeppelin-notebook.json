{"paragraphs":[{"text":"val businessDF = spark.read.json(\"<datadir>/yelp_academic_dataset_business.json\").drop(\"attributes\")\nval goodBusinessDF = businessDF\n      .filter(businessDF.col(\"stars\") > 4) // star 많이 받은 가게\n      .filter(businessDF.col(\"review_count\") > 100) // 리뷰가 충분히 있는 가게\n      .filter(businessDF.col(\"is_open\") === 1) // 현재 운영 중인 가게\n      .drop(\"is_open\")\n      .drop(\"review_count\")\n      .drop(\"stars\")\n      .drop(\"attributes\")\n      .drop(\"categories\")\n      .drop(\"hours\")\n      .drop(\"postal_code\")\n      .drop(\"state\")\n      .withColumnRenamed(\"business_id\", \"business-business_id\")\n    //      .withColumnRenamed(\"address\", \"business-address\")\n    //      .withColumnRenamed(\"city\", \"business-city\")\n    //      .withColumnRenamed(\"latitude\", \"business-latitude\")\n    //      .withColumnRenamed(\"longitude\", \"business-longitude\")\n    //      .withColumnRenamed(\"name\", \"business-name\")\ngoodBusinessDF.printSchema\ngoodBusinessDF.count\ngoodBusinessDF.show","user":"anonymous","dateUpdated":"2019-04-02T00:27:04+0900","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- address: string (nullable = true)\n |-- business-business_id: string (nullable = true)\n |-- city: string (nullable = true)\n |-- latitude: double (nullable = true)\n |-- longitude: double (nullable = true)\n |-- name: string (nullable = true)\n\n+--------------------+--------------------+----------+-------------+---------------+--------------------+\n|             address|business-business_id|      city|     latitude|      longitude|                name|\n+--------------------+--------------------+----------+-------------+---------------+--------------------+\n|6055 E Lake Mead ...|tstimHoMcYbkSC4eB...| Las Vegas|   36.1956146|   -115.0405289|Maria's Mexican R...|\n|       4606 Penn Ave|dQj5DLZjeDK3KFysh...|Pittsburgh|   40.4656937|    -79.9493238|              Apteka|\n|       436 Market St|v-scZMU6jhnmV955R...|Pittsburgh|    40.441062|     -80.002126|   No. 1 Sushi Sushi|\n|6955 N Durango Dr...|f2ZWZPENViL92BrFs...| Las Vegas|   36.2873119|   -115.2895402|        Amazing Cuts|\n|1770 W Horizon Ri...|jScBTQtdAt-8Rshai...| Henderson|   36.0107451|   -115.0648029|              Served|\n|322 Adelaide Stre...|c35qzLN6ItDpVIoj2...|   Toronto|   43.6475853|    -79.3920316|          Ravi Soups|\n|2716 N Green Vall...|Qb4sJ4ssSX1clY2wE...| Henderson|     36.06966|    -115.081085|        Trader Joe's|\n| 10624 S Eastern Ave|jX9DocoiY4Bo9EUka...| Henderson|     35.99822|    -115.102246|           China AAA|\n|4101 Rue Sherbroo...|G_05ZI4Vpl4bxjjZR...|  Montréal|45.5603345562| -73.5612237261|Jardin Botanique ...|\n|1600 E Woodlawn R...|RGK23CEkDfYHWtUbR...| Charlotte|35.1717355947| -80.8492714539|The Turnhouse Grille|\n|  1923 E Mcdowell Rd|9vub2LM7Djy8P-LPu...|   Phoenix|    33.465551|   -112.0401151|        Tacos Chiwas|\n|1716 W Horizon Ri...|1nF8Me63cpxIkFK8Y...| Henderson|    36.011899|   -115.0628631|Shabu Shabu Paradise|\n|5095 S Fort Apach...|BolK3j0LiGtxYxfRh...| Las Vegas|    36.096734|    -115.297787|       Best Mattress|\n|1215 S Fort Apach...|HTngUd7s8kLBiAbEt...| Las Vegas|36.1585666586|-115.2918211553|    Elements Massage|\n|2519 Rue Notre-Da...|IkilcGqiN3_sQk-Vv...|  Montréal|     45.48277|    -73.5754852|     Le Vin Papillon|\n|   362 King Street E|fGdUxfeEWp9pn2sAa...|   Toronto|   43.6535432|    -79.3620478|             Roselle|\n|      9393 E Bell Rd|6nKR80xEGHYf2UxAe...|Scottsdale|33.6393699646|-111.8792572021|       The Thumb BBQ|\n|  119 E Southern Ave|4PqqRa7o_eNydKdGW...|     Tempe|   33.3915708|   -111.9383874|    Tempe City Tacos|\n|2948 E Bell Rd, S...|yb7ZtgMWSZboG_sSU...|   Phoenix|    33.641031|    -112.018653|     Fuego Taco Shop|\n|8174 Las Vegas Bl...|drLbXX7aRs7_1QAIV...| Las Vegas|36.0411986057|-115.1705467439|     Boulevard Salon|\n+--------------------+--------------------+----------+-------------+---------------+--------------------+\nonly showing top 20 rows\n\nbusinessDF: org.apache.spark.sql.DataFrame = [address: string, business_id: string ... 11 more fields]\ngoodBusinessDF: org.apache.spark.sql.DataFrame = [address: string, business-business_id: string ... 4 more fields]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://jaeui-mbp:4041/jobs/job?id=129","http://jaeui-mbp:4041/jobs/job?id=130","http://jaeui-mbp:4041/jobs/job?id=131"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1553936490060_76435966","id":"20190330-180130_707678747","dateCreated":"2019-03-30T18:01:30+0900","dateStarted":"2019-04-01T23:46:59+0900","dateFinished":"2019-04-01T23:47:13+0900","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:146"},{"text":"val reviewDF = spark.read.json(\"<datadir>/resources/yelp_academic_dataset_review.json\")\nval goodLatestReviewDF = reviewDF\n  .filter(reviewDF.col(\"date\") > \"2018-01-01 00:00:00\") // 2018 년 이후 리뷰만\n  .filter(reviewDF.col(\"stars\") > 4) // star 많이 맏은 리뷰만\n  .filter(reviewDF.col(\"text\").contains(\"good\") || reviewDF.col(\"text\").contains(\"Good\") ||\n  reviewDF.col(\"text\").contains(\"great\") || reviewDF.col(\"text\").contains(\"Great\") ||\n  reviewDF.col(\"text\").contains(\"nice\") || reviewDF.col(\"text\").contains(\"Nice\") ||\n  reviewDF.col(\"text\").contains(\"cool\") || reviewDF.col(\"text\").contains(\"Cool\") ||\n  reviewDF.col(\"text\").contains(\"wonderful\") || reviewDF.col(\"text\").contains(\"impressive\") ||\n  reviewDF.col(\"text\").contains(\"fine\") || reviewDF.col(\"text\").contains(\"excellent\"))\n  .drop(\"stars\")\n  .drop(\"funny\")\n  .drop(\"cool\")\n  .drop(\"useful\")\n  .drop(\"review_id\")\n  .drop(\"date\")\n  .drop(\"text\")\n  .withColumnRenamed(\"business_id\", \"review-business_id\")\n  .withColumnRenamed(\"user_id\", \"review-user_id\") // 뒤에서 조인해서 신뢰할 만한 유저가 쓴건지 봐야지\n\ngoodLastestReviewDF.printSchema\n// goodLastestReviewDF.count\n// goodLastestReviewDF.show","user":"anonymous","dateUpdated":"2019-04-02T00:27:09+0900","config":{"colWidth":11,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":219,"optionOpen":false}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- review-business_id: string (nullable = true)\n |-- review: string (nullable = true)\n |-- review-user_id: string (nullable = true)\n\nreviewDF: org.apache.spark.sql.DataFrame = [business_id: string, cool: bigint ... 7 more fields]\ngoodLatestReviewDF: org.apache.spark.sql.DataFrame = [review-business_id: string, review-user_id: string]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://jaeui-mbp:4041/jobs/job?id=153"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1553937112163_-314780628","id":"20190330-181152_1547121082","dateCreated":"2019-03-30T18:11:52+0900","dateStarted":"2019-04-02T00:10:15+0900","dateFinished":"2019-04-02T00:10:47+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:147"},{"text":"val userDF = spark.read.json(\"<datadir>/resources/yelp_academic_dataset_user.json\")\nval goodUserDF = userDF\n  .filter(userDF.col(\"average_stars\") > 4) // good user\n  .filter(userDF.col(\"fans\") > 50) // famous user\n  .filter(userDF.col(\"review_count\") > 200) // famous user\n  .filter(userDF.col(\"useful\") > 500) // famous user\n  .drop(\"average_stars\")\n  .drop(\"fans\")\n  .drop(\"friends\")\n  .drop(\"review_count\")\n  .drop(\"useful\")\n  .drop(\"compliment_cool\")\n  .drop(\"compliment_cute\")\n  .drop(\"compliment_funny\")\n  .drop(\"compliment_hot\")\n  .drop(\"compliment_list\")\n  .drop(\"compliment_more\")\n  .drop(\"compliment_note\")\n  .drop(\"compliment_photos\")\n  .drop(\"compliment_plain\")\n  .drop(\"compliment_profile\")\n  .drop(\"compliment_writer\")\n  .drop(\"cool\")\n  .drop(\"elite\")\n  .drop(\"funny\")\n  .drop(\"name\")\n  .drop(\"yelping_since\")\n  .withColumnRenamed(\"user_id\", \"user-user_id\")\n      \ngoodUserDF.printSchema\ngoodUserDF.count\n// goodUserDF.show","user":"anonymous","dateUpdated":"2019-04-02T00:27:19+0900","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- user-user_id: string (nullable = true)\n\nuserDF: org.apache.spark.sql.DataFrame = [average_stars: double, compliment_cool: bigint ... 20 more fields]\ngoodUserDF: org.apache.spark.sql.DataFrame = [user-user_id: string]\nres81: Long = 1749\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://jaeui-mbp:4041/jobs/job?id=134","http://jaeui-mbp:4041/jobs/job?id=135"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1553937111639_-2088106269","id":"20190330-181151_1226211104","dateCreated":"2019-03-30T18:11:51+0900","dateStarted":"2019-04-01T23:48:24+0900","dateFinished":"2019-04-01T23:49:37+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:149"},{"text":"val goodReviewByGoodUserDF = goodUserDF.join(goodLatestReviewDF, goodLatestReviewDF(\"review-user_id\") === goodUserDF(\"user-user_id\"))\n  .drop(\"review-user_id\")\n  .drop(\"user-user_id\")\n  .distinct\n  \ngoodReviewByGoodUserDF.printSchema\ngoodReviewByGoodUserDF.count","user":"anonymous","dateUpdated":"2019-04-02T00:10:51+0900","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- review-business_id: string (nullable = true)\n\ngoodReviewByGoodUserDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [review-business_id: string]\nres93: Long = 2379\n"}]},"apps":[],"jobName":"paragraph_1553936510871_153236353","id":"20190330-180150_1268983712","dateCreated":"2019-03-30T18:01:50+0900","dateStarted":"2019-04-02T00:10:51+0900","dateFinished":"2019-04-02T00:11:52+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:150","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://jaeui-mbp:4041/jobs/job?id=154"],"interpreterSettingId":"spark"}}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1553936717331_-1049240866","id":"20190330-180517_1971140359","dateCreated":"2019-03-30T18:05:17+0900","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:151","text":"val result = goodReviewByGoodUserDF.join(goodBusinessDF, goodReviewByGoodUserDF(\"review-business_id\") === goodBusinessDF(\"business-business_id\"))\n  .drop(\"review-business_id\")\n  .withColumnRenamed(\"business-business_id\", \"business_id\")\n  \nresult.printSchema\nresult.count","dateUpdated":"2019-04-02T00:10:53+0900","dateFinished":"2019-04-02T00:12:57+0900","dateStarted":"2019-04-02T00:10:53+0900","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- address: string (nullable = true)\n |-- business_id: string (nullable = true)\n |-- city: string (nullable = true)\n |-- latitude: double (nullable = true)\n |-- longitude: double (nullable = true)\n |-- name: string (nullable = true)\n\nresult: org.apache.spark.sql.DataFrame = [address: string, business_id: string ... 4 more fields]\nres94: Long = 424\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://jaeui-mbp:4041/jobs/job?id=155","http://jaeui-mbp:4041/jobs/job?id=156"],"interpreterSettingId":"spark"}}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1554130860191_148138700","id":"20190402-000100_508815104","dateCreated":"2019-04-02T00:01:00+0900","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1274"}],"name":"test","id":"2E94A16AS","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}